#! /bin/bash
#
#  U.S. Geological Survey
#
#  File - data-loader
#
#  Purpose - Docker/Shifter entry-point for data-loader service.
#
#  Author - Andrew Halper <ashalper@usgs.gov>
#

if [ "$X" = -x ]; then
  set -x			# run in debug mode
fi

set -e

mkdir -p /nhm/gridmetetl/Output

if [ -f /nhm/gridmetetl/$HRU_DATA_PKG ]; then
    echo "HRU shapefiles already loaded"
else
    cd /nhm/gridmetetl
    # ...download archive
    wget --waitretry=3 --retry-connrefused "$HRU_SOURCE"
    # uncompress archive
    unzip $HRU_DATA_PKG
    chown -R nhm /nhm/gridmetetl
    chmod -R 766 /nhm/gridmetetl
fi

if [ -f /nhm/$PRMS_DATA_PKG ]; then
    echo "PRMS workspace already loaded"
else
    cd /nhm
    # ...download it
    wget --waitretry=3 --retry-connrefused "$PRMS_SOURCE"
    unzip "$PRMS_DATA_PKG"
    chown -R nhm /nhm/NHM-PRMS_CONUS_GF_1_1
    chmod -R 766 /nhm/NHM-PRMS_CONUS_GF_1_1
fi
