version: "3.3"

volumes:
  nhm:
    driver: local

services:
    
  base_image:
    build: 
      context: ./nhmusgs-base
      labels:
        - "gov.usgs.nhm.image.docker.application=NHM"
        - "gov.usgs.nhm.image.docker.type=Base Image"
    image: nhmusgs/base:1.1
    env_file:
      - nhm.env

  data-loader:
    build:
      context: ./nhmusgs-data-loader
      labels:
        - "gov.usgs.nhm.image.docker.application=NHM"
        - "gov.usgs.nhm.image.docker.type=Data Loader"
    image: nhmusgs/data-loader:1.1
    container_name: data-loader
    env_file:
      - nhm.env
    volumes:
      - nhm:/nhm

  gridmet-current:
    build:
      context: ./nhmusgs-gridmet-current
      labels:
        - "gov.usgs.nhm.image.docker.application=NHM"
        - "gov.usgs.nhm.image.docker.type=Gridmet Query"
    image: nhmusgs/gridmet-current:1.1
    container_name: gridmet-current
    env_file:
      - nhm.env
    volumes:
      - nhm:/nhm
      
  gridmetetl:
    build:
      context: ./nhmusgs-gridmetetl
      labels:
        - "gov.usgs.nhm.image.docker.application=NHM"
        - "gov.usgs.nhm.image.docker.type=GRIDMETETL"
    image: nhmusgs/gridmetetl:1.1
    container_name: gridmetetl
    environment:
      - CBH_IDIR
      - START_DATE
      - END_DATE
      - NHM_SOURCE_DIR
    env_file:
      - nhm.env
    volumes:
      - nhm:/nhm

  ncf2cbh:
    build:
      context: ./nhmusgs-ncf2cbh
      labels:
        - "gov.usgs.nhm.image.docker.application=NHM"
        - "gov.usgs.nhm.image.docker.type=NCF2CBH"
    image: nhmusgs/ncf2cbh:1.1
    container_name: ncf2cbh
    env_file:
      - nhm.env
    volumes:
      - nhm:/nhm

  cbhfiller:
    build:
      context: ./nhmusgs-cbhfiller
      labels:
        - "gov.usgs.nhm.image.docker.application=NHM"
        - "gov.usgs.nhm.image.docker.type=CBHFILLER"
    image: nhmusgs/cbhfiller:1.1
    container_name: cbhfiller
    environment:
        - CBH_IDIR
        - CBH_ODIR
    env_file:
      - nhm.env
    volumes:
      - nhm:/nhm

  nhm-prms:
    build:
      context: ./nhmusgs-nhm-prms
      labels:
        - "gov.usgs.nhm.image.docker.application=NHM"
        - "gov.usgs.nhm.image.docker.type=PRMS"
    image: nhmusgs/nhm-prms:1.1
    container_name: nhm-prms
    environment:
      - END_TIME
      - NHM_SOURCE_DIR
      - SAVE_VARS_TO_FILE
      - START_DATE
      - START_TIME
      - RESTART_DATE
      - VAR_SAVE_FILE
    env_file:
      - nhm.env
    volumes:
      - nhm:/nhm

  out2ncf:
    build:
      context: ./nhmusgs-nhm-out2ncf
      labels:
        - "gov.usgs.nhm.image.docker.application=NHM"
        - "gov.usgs.nhm.image.docker.type=OUT 2 NCF"
    image: nhmusgs/out2ncf:1.1
    container_name: out2ncf
    env_file:
      - nhm.env
    volumes:
      - nhm:/nhm

  verifier:
    build:
      context: ./nhmusgs-verifier
      labels:
        - "gov.usgs.nhm.image.docker.application=NHM"
        - "gov.usgs.nhm.image.docker.type=Verifier"
    image: nhmusgs/verifier:1.1
    container_name: verifier
    env_file:
      - nhm.env
    volumes:
      - nhm:/nhm
    command:
      - "/nhm/NHM-PRMS_CONUS_GF_1_1/"
